{
  "title": "üõ°Ô∏è Task: Add domain exceptions and validation rules",
  "body": "## üõ°Ô∏è Domain Task - Exception Handling and Business Rule Validation\n\n### Overview\nImplement comprehensive domain exceptions and validation rules to ensure data integrity and business rule enforcement at the domain layer level.\n\n### Scope\nThis task creates a robust exception handling system and validation framework that enforces business rules and maintains domain invariants across all EduTrack entities.\n\n### Implementation Checklist\n\n#### Domain Exception Infrastructure\n- [ ] Create `DomainException` base class with rich error information\n- [ ] Implement `BusinessRuleViolationException` for rule violations\n- [ ] Create `EntityNotFoundException` for missing entities\n- [ ] Implement `InvalidOperationException` for illegal operations\n- [ ] Add `ValidationException` for input validation failures\n- [ ] Create exception hierarchy with categorization\n- [ ] Implement error code system for localization support\n- [ ] Add exception context and metadata collection\n\n#### Student Domain Exceptions\n- [ ] `StudentNotFoundException` - Student not found by ID or number\n- [ ] `StudentAlreadyEnrolledException` - Duplicate enrollment attempt\n- [ ] `StudentNotEligibleException` - Eligibility requirements not met\n- [ ] `InvalidStudentStatusException` - Invalid status transition\n- [ ] `StudentCapacityExceededException` - Course enrollment full\n- [ ] `PrerequisiteNotMetException` - Missing course prerequisites\n- [ ] `AcademicStandingException` - Academic probation restrictions\n- [ ] `FinancialHoldException` - Outstanding financial obligations\n\n#### Course Domain Exceptions\n- [ ] `CourseNotFoundException` - Course not found by code or ID\n- [ ] `CourseNotAvailableException` - Course not open for enrollment\n- [ ] `InvalidCourseCodeException` - Malformed course identifier\n- [ ] `CourseCapacityExceededException` - Enrollment over capacity\n- [ ] `CourseScheduleConflictException` - Time/room conflicts\n- [ ] `InvalidCourseLevelException` - Inappropriate course level\n- [ ] `PrerequisiteCircularReferenceException` - Circular prerequisites\n- [ ] `CourseAlreadyCompletedException` - Repeat enrollment of passed course\n\n#### Teacher Domain Exceptions\n- [ ] `TeacherNotFoundException` - Teacher not found by ID or employee number\n- [ ] `TeacherNotQualifiedException` - Insufficient qualifications for course\n- [ ] `TeachingLoadExceededException` - Maximum teaching hours exceeded\n- [ ] `TeacherUnavailableException` - Teacher not available for assignment\n- [ ] `InvalidTeacherStatusException` - Inappropriate teacher status\n- [ ] `DepartmentMismatchException` - Course-teacher department conflict\n- [ ] `ConcurrentAssignmentException` - Schedule double-booking\n\n#### Validation Rules Framework\n- [ ] Create `IValidationRule<T>` interface for entity validation\n- [ ] Implement `ValidationResult` class with error details\n- [ ] Create `ValidationEngine` for rule execution and aggregation\n- [ ] Implement fluent validation rule builder\n- [ ] Add conditional validation rule support\n- [ ] Create validation rule composition (AND, OR operations)\n- [ ] Implement cross-entity validation rules\n- [ ] Add async validation rule support for database checks\n\n#### Student Validation Rules\n- [ ] **Email Validation Rule** - Valid email format and uniqueness\n- [ ] **Phone Number Validation Rule** - Valid phone format by region\n- [ ] **Date of Birth Validation Rule** - Age requirements and realistic dates\n- [ ] **Student Number Validation Rule** - Format and uniqueness validation\n- [ ] **GPA Validation Rule** - Scale validation (0.0-4.0) and calculation\n- [ ] **Enrollment Status Validation Rule** - Valid status transitions\n- [ ] **Academic Standing Validation Rule** - Credit hour and GPA requirements\n- [ ] **Program Eligibility Validation Rule** - Prerequisites and requirements\n\n#### Course Validation Rules\n- [ ] **Course Code Validation Rule** - Format, uniqueness, and standards\n- [ ] **Credit Hours Validation Rule** - Valid range (1-6) and type constraints\n- [ ] **Capacity Validation Rule** - Minimum/maximum enrollment limits\n- [ ] **Schedule Validation Rule** - Valid time slots and duration\n- [ ] **Prerequisite Validation Rule** - Circular reference detection\n- [ ] **Department Validation Rule** - Course belongs to valid department\n- [ ] **Course Level Validation Rule** - Appropriate for program level\n- [ ] **Academic Calendar Validation Rule** - Valid semester and dates\n\n#### Teacher Validation Rules\n- [ ] **Employee ID Validation Rule** - Format and uniqueness validation\n- [ ] **Qualification Validation Rule** - Required degrees and certifications\n- [ ] **Teaching Load Validation Rule** - Maximum hours and course limits\n- [ ] **Department Assignment Validation Rule** - Valid department membership\n- [ ] **Contact Information Validation Rule** - Required fields and formats\n- [ ] **Availability Validation Rule** - Schedule and time constraints\n- [ ] **Performance History Validation Rule** - Evaluation requirements\n\n### Technical Implementation\n\n#### Domain Exception Base Classes\n```csharp\npublic abstract class DomainException : Exception\n{\n    public string ErrorCode { get; }\n    public Dictionary<string, object> Context { get; }\n    public DateTime OccurredAt { get; }\n    \n    protected DomainException(string message, string errorCode) : base(message)\n    {\n        ErrorCode = errorCode;\n        Context = new Dictionary<string, object>();\n        OccurredAt = DateTime.UtcNow;\n    }\n    \n    public DomainException AddContext(string key, object value)\n    {\n        Context[key] = value;\n        return this;\n    }\n}\n\npublic class BusinessRuleViolationException : DomainException\n{\n    public string RuleName { get; }\n    \n    public BusinessRuleViolationException(string ruleName, string message) \n        : base(message, $\"BUSINESS_RULE_VIOLATION_{ruleName.ToUpper()}\")\n    {\n        RuleName = ruleName;\n    }\n}\n```\n\n#### Specific Domain Exceptions\n```csharp\npublic class StudentNotFoundException : DomainException\n{\n    public StudentNotFoundException(Guid studentId) \n        : base($\"Student with ID {studentId} was not found\", \"STUDENT_NOT_FOUND\")\n    {\n        AddContext(\"StudentId\", studentId);\n    }\n    \n    public StudentNotFoundException(string studentNumber) \n        : base($\"Student with number {studentNumber} was not found\", \"STUDENT_NOT_FOUND\")\n    {\n        AddContext(\"StudentNumber\", studentNumber);\n    }\n}\n\npublic class PrerequisiteNotMetException : BusinessRuleViolationException\n{\n    public PrerequisiteNotMetException(string courseCode, IEnumerable<string> missingPrerequisites)\n        : base(\"PREREQUISITE_NOT_MET\", \n               $\"Cannot enroll in {courseCode}. Missing prerequisites: {string.Join(\", \", missingPrerequisites)}\")\n    {\n        AddContext(\"CourseCode\", courseCode)\n           .AddContext(\"MissingPrerequisites\", missingPrerequisites);\n    }\n}\n```\n\n#### Validation Rule Interface\n```csharp\npublic interface IValidationRule<in T>\n{\n    string RuleName { get; }\n    ValidationResult Validate(T entity);\n    Task<ValidationResult> ValidateAsync(T entity);\n}\n\npublic class ValidationResult\n{\n    public bool IsValid { get; }\n    public IEnumerable<ValidationError> Errors { get; }\n    \n    public static ValidationResult Success() => new ValidationResult(true, Array.Empty<ValidationError>());\n    public static ValidationResult Failure(params ValidationError[] errors) => new ValidationResult(false, errors);\n}\n\npublic class ValidationError\n{\n    public string PropertyName { get; }\n    public string ErrorMessage { get; }\n    public string ErrorCode { get; }\n    public object AttemptedValue { get; }\n}\n```\n\n#### Example Validation Rules\n```csharp\npublic class StudentEmailValidationRule : IValidationRule<Student>\n{\n    private readonly IStudentRepository _studentRepository;\n    \n    public string RuleName => \"StudentEmailValidation\";\n    \n    public ValidationResult Validate(Student student)\n    {\n        var errors = new List<ValidationError>();\n        \n        // Format validation\n        if (!IsValidEmailFormat(student.Email.Value))\n        {\n            errors.Add(new ValidationError(nameof(student.Email), \n                \"Invalid email format\", \"INVALID_EMAIL_FORMAT\", student.Email.Value));\n        }\n        \n        return errors.Any() ? ValidationResult.Failure(errors.ToArray()) : ValidationResult.Success();\n    }\n    \n    public async Task<ValidationResult> ValidateAsync(Student student)\n    {\n        var result = Validate(student);\n        if (!result.IsValid) return result;\n        \n        // Uniqueness validation (async)\n        var existingStudent = await _studentRepository.GetByEmailAsync(student.Email);\n        if (existingStudent != null && existingStudent.Id != student.Id)\n        {\n            return ValidationResult.Failure(\n                new ValidationError(nameof(student.Email), \n                    \"Email address is already in use\", \"EMAIL_ALREADY_EXISTS\", student.Email.Value));\n        }\n        \n        return ValidationResult.Success();\n    }\n}\n\npublic class CoursePrerequisiteValidationRule : IValidationRule<Course>\n{\n    public string RuleName => \"CoursePrerequisiteValidation\";\n    \n    public ValidationResult Validate(Course course)\n    {\n        // Check for circular prerequisites\n        if (HasCircularPrerequisites(course))\n        {\n            return ValidationResult.Failure(\n                new ValidationError(nameof(course.Prerequisites),\n                    \"Circular prerequisite dependency detected\",\n                    \"CIRCULAR_PREREQUISITES\", course.Prerequisites));\n        }\n        \n        return ValidationResult.Success();\n    }\n}\n```\n\n#### Entity Integration\n- [ ] Add validation to entity constructors and property setters\n- [ ] Implement `Validate()` method on all domain entities\n- [ ] Create validation on aggregate root boundary\n- [ ] Add validation result collection in domain events\n- [ ] Implement validation caching for performance\n\n#### Error Handling Strategy\n- [ ] Create exception handling middleware for API layer\n- [ ] Implement error response standardization\n- [ ] Add exception logging and monitoring\n- [ ] Create user-friendly error message mapping\n- [ ] Implement exception recovery strategies\n\n### Testing Requirements\n- [ ] Unit tests for all domain exceptions\n- [ ] Unit tests for all validation rules\n- [ ] Integration tests for exception scenarios\n- [ ] Tests for validation rule composition\n- [ ] Performance tests for validation execution\n- [ ] Tests for exception context and metadata\n\n### File Structure\n```\nsrc/EduTrack.Domain/\n‚îú‚îÄ‚îÄ Exceptions/\n‚îÇ   ‚îú‚îÄ‚îÄ DomainException.cs\n‚îÇ   ‚îú‚îÄ‚îÄ BusinessRuleViolationException.cs\n‚îÇ   ‚îú‚îÄ‚îÄ EntityNotFoundException.cs\n‚îÇ   ‚îú‚îÄ‚îÄ Student/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentNotFoundException.cs\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentNotEligibleException.cs\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PrerequisiteNotMetException.cs\n‚îÇ   ‚îú‚îÄ‚îÄ Course/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CourseNotFoundException.cs\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CourseNotAvailableException.cs\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CourseCapacityExceededException.cs\n‚îÇ   ‚îî‚îÄ‚îÄ Teacher/\n‚îÇ       ‚îú‚îÄ‚îÄ TeacherNotFoundException.cs\n‚îÇ       ‚îú‚îÄ‚îÄ TeacherNotQualifiedException.cs\n‚îÇ       ‚îî‚îÄ‚îÄ TeachingLoadExceededException.cs\n‚îú‚îÄ‚îÄ Validation/\n‚îÇ   ‚îú‚îÄ‚îÄ IValidationRule.cs\n‚îÇ   ‚îú‚îÄ‚îÄ ValidationResult.cs\n‚îÇ   ‚îú‚îÄ‚îÄ ValidationError.cs\n‚îÇ   ‚îú‚îÄ‚îÄ ValidationEngine.cs\n‚îÇ   ‚îú‚îÄ‚îÄ Student/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentEmailValidationRule.cs\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentGpaValidationRule.cs\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StudentStatusValidationRule.cs\n‚îÇ   ‚îú‚îÄ‚îÄ Course/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CourseCodeValidationRule.cs\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CourseCapacityValidationRule.cs\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CoursePrerequisiteValidationRule.cs\n‚îÇ   ‚îî‚îÄ‚îÄ Teacher/\n‚îÇ       ‚îú‚îÄ‚îÄ TeacherQualificationValidationRule.cs\n‚îÇ       ‚îú‚îÄ‚îÄ TeachingLoadValidationRule.cs\n‚îÇ       ‚îî‚îÄ‚îÄ TeacherAvailabilityValidationRule.cs\n‚îî‚îÄ‚îÄ Common/\n    ‚îú‚îÄ‚îÄ ErrorCodes.cs\n    ‚îî‚îÄ‚îÄ BusinessRules.cs\n```\n\n### Integration Points\n- [ ] Application layer exception handling\n- [ ] API layer error response formatting\n- [ ] Infrastructure layer validation execution\n- [ ] Logging and monitoring system integration\n- [ ] Localization service for error messages\n\n### Acceptance Criteria\n- [ ] All domain exceptions provide clear, actionable error information\n- [ ] Validation rules enforce all business constraints\n- [ ] Exception hierarchy supports proper error categorization\n- [ ] Validation rules can be composed and reused\n- [ ] Error context provides sufficient debugging information\n- [ ] Performance impact of validation is minimal (<10ms per entity)\n- [ ] Unit tests achieve >95% coverage\n- [ ] Integration tests verify exception scenarios\n- [ ] Documentation includes error handling guidelines\n\n### Dependencies\n- Depends on: Core domain entities, Domain services\n- Blocks: Application layer error handling\n- Integrates with: Repository pattern, CQRS validation\n\n### Estimated Effort\n**8-10 hours** (2-3 development sessions)\n\n### Definition of Done\n- [ ] All domain exceptions implemented with proper inheritance\n- [ ] Validation rules created for all business constraints\n- [ ] Entity validation integration completed\n- [ ] Exception context and metadata system functional\n- [ ] Unit and integration tests passing\n- [ ] Code review completed\n- [ ] Documentation includes exception handling guide\n- [ ] Performance benchmarks meet requirements\n\n### Priority\n**High** - Critical for data integrity and user experience",
  "labels": ["task", "domain-layer", "exceptions", "validation", "business-rules", "high-priority", "clean-architecture"],
  "assignees": ["mahedee"]
}
